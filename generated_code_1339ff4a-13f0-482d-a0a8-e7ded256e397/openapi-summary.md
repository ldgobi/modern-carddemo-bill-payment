# Bill Payment API - OpenAPI Summary

## Overview
This document provides a summary of the Bill Payment API endpoints following the OpenAPI specification.

## Base URL
```
/api/bill-payment
```

## Endpoints

### 1. Get Account Balance

**Endpoint:** `GET /api/bill-payment/account/{accountId}/balance`

**Description:** Retrieves the current balance for a specified account.

**Parameters:**
- `accountId` (path parameter, required): The account identifier (String, max 11 characters)

**Responses:**
- `200 OK`: Successfully retrieved account balance
  - Content-Type: `application/json`
  - Schema: `AccountBalanceDTO`
    ```json
    {
      "accountId": "string",
      "currentBalance": "number"
    }
    ```
- `404 Not Found`: Account not found
- `400 Bad Request`: Invalid account ID

**Example Request:**
```
GET /api/bill-payment/account/12345678901/balance
```

**Example Response:**
```json
{
  "accountId": "12345678901",
  "currentBalance": 1500.50
}
```

---

### 2. Process Bill Payment

**Endpoint:** `POST /api/bill-payment/process`

**Description:** Processes a bill payment for the specified account, paying the full account balance.

**Request Body:**
- Content-Type: `application/json`
- Schema: `BillPaymentRequestDTO`
  ```json
  {
    "accountId": "string",
    "confirmPayment": "boolean"
  }
  ```

**Request Body Fields:**
- `accountId` (required): Account identifier (String, max 11 characters, not blank)
- `confirmPayment` (required): Payment confirmation flag (Boolean, must be true to process)

**Responses:**
- `200 OK`: Payment processed successfully
  - Content-Type: `application/json`
  - Schema: `BillPaymentResponseDTO`
    ```json
    {
      "transactionId": "string",
      "message": "string",
      "accountId": "string",
      "paymentAmount": "number",
      "newBalance": "number"
    }
    ```
- `400 Bad Request`: Validation error or business rule violation
  - Account ID is empty
  - Payment not confirmed
  - Account has zero or negative balance
- `404 Not Found`: Account not found or card cross-reference not found

**Example Request:**
```json
POST /api/bill-payment/process
Content-Type: application/json

{
  "accountId": "12345678901",
  "confirmPayment": true
}
```

**Example Response:**
```json
{
  "transactionId": "0000000000000123",
  "message": "Payment successful. Your Transaction ID is 0000000000000123.",
  "accountId": "12345678901",
  "paymentAmount": 1500.50,
  "newBalance": 0.00
}
```

---

## Data Models

### AccountBalanceDTO
```yaml
AccountBalanceDTO:
  type: object
  properties:
    accountId:
      type: string
      maxLength: 11
      description: Account identifier
    currentBalance:
      type: number
      format: decimal
      description: Current account balance with 2 decimal places
```

### BillPaymentRequestDTO
```yaml
BillPaymentRequestDTO:
  type: object
  required:
    - accountId
    - confirmPayment
  properties:
    accountId:
      type: string
      maxLength: 11
      description: Account identifier
      example: "12345678901"
    confirmPayment:
      type: boolean
      description: Payment confirmation flag (must be true)
      example: true
```

### BillPaymentResponseDTO
```yaml
BillPaymentResponseDTO:
  type: object
  properties:
    transactionId:
      type: string
      maxLength: 16
      description: Generated transaction identifier
      example: "0000000000000123"
    message:
      type: string
      description: Success message
      example: "Payment successful. Your Transaction ID is 0000000000000123."
    accountId:
      type: string
      maxLength: 11
      description: Account identifier
      example: "12345678901"
    paymentAmount:
      type: number
      format: decimal
      description: Amount paid (original balance)
      example: 1500.50
    newBalance:
      type: number
      format: decimal
      description: New account balance after payment
      example: 0.00
```

---

## Business Rules

### Account Validation
1. Account ID must not be empty or null
2. Account must exist in the system
3. Account balance must be greater than zero to process payment

### Payment Confirmation
1. User must confirm payment by setting `confirmPayment` to `true`
2. If confirmation is `false` or `null`, payment will not be processed

### Transaction Processing
1. Transaction ID is auto-generated by incrementing the last transaction ID
2. Transaction type code is always '02' for bill payments
3. Transaction category code is always 2 for bill payments
4. Transaction source is 'POS TERM'
5. Transaction description is 'BILL PAYMENT - ONLINE'
6. Payment amount equals the full current account balance
7. Merchant ID is 999999999 for bill payments
8. Merchant name is 'BILL PAYMENT'
9. Merchant city and ZIP are 'N/A'
10. Both origin and process timestamps are set to current timestamp

### Balance Update
1. After successful transaction recording, account balance is reduced by the payment amount
2. New balance should be zero after paying full balance
3. Both transaction and account update are performed in a single transaction (atomic operation)

---

## Error Handling

### Common Error Responses

**400 Bad Request**
- Account ID cannot be empty
- Confirm to make a bill payment
- You have nothing to pay
- Invalid value for confirmPayment

**404 Not Found**
- Account ID NOT found
- Unable to lookup XREF AIX file

**500 Internal Server Error**
- Unable to generate new transaction ID
- Unable to Add Bill pay Transaction
- Unable to Update Account

---

## Authentication & Authorization
(To be implemented based on security requirements)

---

## Rate Limiting
(To be implemented based on performance requirements)

---

## Versioning
Current API Version: v1
